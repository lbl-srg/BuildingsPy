dist: bionic

language: python

python:
  - "3.6"

cache: pip

env:
  global:
    - MPLBACKEND=agg
    - MODELICAPATH=${TRAVIS_BUILD_DIR}/buildingspy/tests # Needed to load Modelica models for CI testing
    - PYTHONPATH=${TRAVIS_BUILD_DIR}  # Points to /home/travis/build/lbl-srg/BuildingsPy. Needed for import buildingspy.simulate.OutputGrabber as og

notifications:
  email: false

git:
  depth: 3

services:
  - docker

## fixme addons:
## fixme   apt:
## fixme     sources:
## fixme     - sourceline: "deb http://build.openmodelica.org/apt `lsb_release -cs` stable"
## fixme       key_url: "http://build.openmodelica.org/apt/openmodelica.asc"
## fixme     packages:
## fixme     - omc
## fixme     - omlib-modelica-3.2.?
## fixme     - tidy

before_install:
  - chmod +x buildingspy/tests/MyModelicaLibrary/Resources/Scripts/travis/bin/dymola
  - sudo cp buildingspy/tests/MyModelicaLibrary/Resources/Scripts/travis/bin/dymola /usr/local/bin/
  - chmod +x buildingspy/tests/MyModelicaLibrary/Resources/Scripts/travis/bin/jm_ipython.sh
  - sudo cp buildingspy/tests/MyModelicaLibrary/Resources/Scripts/travis/bin/jm_ipython.sh /usr/local/bin/
  - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
  - docker pull "$DOCKER_USERNAME"/travis_ubuntu-1804_dymola-2020x-x86_64
## fixme  - docker pull "$DOCKER_USERNAME"/ubuntu-1804_jmodelica_trunk
  - python -m pip install --upgrade pip

install:
  - pip install -r requirements.txt
  - pip install .
## fixme  - pip install sphinx==2.1.2 \
## fixme      sphinx-bootstrap-theme==0.7.1 \
## fixme      sphinxcontrib-bibtex==0.4.2 \
## fixme      sphinxcontrib-plantuml==0.17 \
## fixme      alabaster==0.7.12 \
## fixme      MarkupSafe==1.1.1 \
## fixme      Pygments==2.4.2 \
## fixme      snowballstemmer==1.9.0 \
## fixme      docutils==0.15.2 \
## fixme      Babel==2.7.0 \
## fixme      requests==2.22.0 \
## fixme      Jinja2==2.10.1 \
## fixme      latexcodec==1.0.7 \
## fixme      pybtex==0.22.2
## fixme      pybtex-docutils==0.2.1 \
## fixme      oset==0.1.3 \
## fixme      PyYAML==5.1.2;


# Execute tests
script:
##  - python buildingspy/tests/test_development_regressiontest_optimica.py Test_regressiontest_optimica_Tester.test_regressiontest_diagnostics
##  - python buildingspy/tests/test_development_regressiontest_jmodelica.py Test_regressiontest_jmodelica_Tester.test_regressiontest_diagnostics
## - python buildingspy/tests/test_simulate_Optimica.py Test_simulate_Simulator.test_addMethods
## - echo "*** Current directory `pwd`"
## - echo "*** Files in current directory `ls -lhtr`"
##- python buildingspy/tests/test_simulate_Dymola.py Test_simulate_Simulator.test_addMethods
- python buildingspy/tests/test_development_regressiontest.py Test_regressiontest_Tester.test_regressiontest
## - echo "*** Files in current directory `ls -lhtr`"
## - echo "*** Files in /tmp/ `ls -lhtr /tmp/tmp-MyModelicaLibrary*`"
## - echo "*** Files in /tmp/.../MyModelicaLibrary `ls -lhtr /tmp/tmp-MyModelicaLibrary*/MyModelicaLibrary`"

## fixme - omc --version
## fixme - make pep8 PEP8_CORRECT_CODE=true
## fixme - make doctest
## fixme - make unittest
## fixme - make doc

after_failure:
  - |
    for ff in `find . -name '*.log'`; do
      echo "*** Content of $ff"
      cat $ff
      echo "*** End of $ff"
    done
